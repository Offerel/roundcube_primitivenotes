function pnoptions(){location.href=window.location.origin+window.location.pathname+"?_task=settings&_action=preferences#pnotes"}function add_note(){document.getElementById("upl").click()}function new_note(e){format=e||rcmail.env.dformat;let t=document.createElement("input");t.id="note_name",t.name=t.id,t.type="text",t.style="font-size: 2em",t.required=!0,t.value="",$("#notescontentframe").contents().find("#headerTitle").replaceWith(t),$("#notescontentframe").contents().find("#note_name").replaceWith(t),$("#notescontentframe").contents().find("tags").addClass("edit"),$("#notescontentframe").contents().find("#tbutton").remove();let n={tstate:!1,ttags:"",editor:"new",format:format};document.getElementById("notescontentframe").contentWindow.postMessage(n,location.href),$("#notescontentframe").contents().find("#note_name")[0].placeholder=rcmail.gettext("note_title","primitivenotes"),document.getElementById("editnote").classList.add("disabled"),document.getElementById("deletenote").classList.add("disabled"),document.getElementById("sendnote").classList.add("disabled")}function edit_note(){let e=$("#notescontentframe").contents().find("#headerTitle");$("#notescontentframe").contents().find("#tbutton").remove();let t=document.createElement("input");t.id="note_name",t.name=t.id,t.type="text",t.style="font-size: 2em",t.required=!0,t.value=e[0].innerText,e.replaceWith(t);let n={tstate:!1,editor:"edit"};document.getElementById("notescontentframe").contentWindow.postMessage(n,location.href),$("#notescontentframe").contents().find("tags").addClass("edit"),document.getElementById("editnote").classList.add("disabled")}function delete_note(){var e=window.frames.notescontentframe.document.getElementById("fname").value,t=window.frames.notescontentframe.document.getElementById("headerTitle").innerText,n=rcmail.gettext("note_del_note","primitivenotes").replace("%note%",t);if(e&&t){if(!confirm(n))return!1;$.ajax({url:"plugins/primitivenotes/notes.php",type:"post",data:{action:"delNote",mode:"delete",fileid:e},success:function(e){if(""!=e){var t=JSON.parse(e);""!=t.data&&confirm(t.message)&&$.ajax({url:"plugins/primitivenotes/notes.php",type:"post",data:{action:"delMedia",files:JSON.stringify(t.data)}})}document.getElementById("notescontentframe").src="plugins/primitivenotes/notes.php"}})}}function send_note(){var e=window.frames.notescontentframe.document.getElementById("fname").value,t=e.substring(e.lastIndexOf(".")+1);-1<"html pdf jpg png md txt".split(" ").indexOf(t)?rcmail.goto_url("mail/compose",{_note_type:t,_note_filename:e},!0):alert(rcmail.gettext("note_inv_format","primitivenotes"))}function sform(){fileName=this.value;for(var e=new Array("html","pdf","jpg","png","md","txt"),t=fileName.split(".").pop().toLowerCase(),n=0;n<=e.length;n++)if(e[n]==t)return document.getElementById("upl_form").submit(),!0;return alert('<roundcube:label name="primitivenotes.note_inv_format" />'),!1}window.rcmail&&rcmail.addEventListener("init",function(e){if(rcmail.register_command("newnote",new_note,!0),rcmail.register_command("editnote",edit_note,!0),rcmail.register_command("deletenote",delete_note,!0),rcmail.register_command("sendnote",send_note,!0),rcmail.register_command("addnote",add_note,!0),rcmail.register_command("mdnote",new_note,!0),rcmail.register_command("txtnote",new_note,!0),rcmail.register_command("pnoptions",pnoptions,!0),document.getElementById("upl")&&document.getElementById("upl").addEventListener("change",sform,!1),"#pnotes"==window.location.hash&&rcmail.sections_list.select_row("primitivenotes"),rcmail.env.contextmenu){let e=rcmail.contextmenu.init({menu_name:"pnotescmenu",menu_source:"#nmenu"});$("#notescontentframe").on("load",function(){$("#notescontentframe").contents().find("#filelist li").each(function(){$(this).on("contextmenu",function(t){rcmail.contextmenu.show_one(t,this,this.firstChild.attributes.value,e)})})})}});