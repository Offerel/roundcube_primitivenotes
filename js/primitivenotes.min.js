/**
 * Roundcube Notes Plugin
 *
 * @version 2.0.6
 * @author Offerel
 * @copyright Copyright (c) 2021, Offerel
 * @license GNU General Public License, version 3
 */
function pnoptions(){location.href=window.location.origin+window.location.pathname+"?_task=settings&_action=preferences#pnotes"}function add_note(){document.getElementById("upl").click()}function new_note(a){format=a||rcmail.env.dformat;let nname=document.createElement("input");nname.id="note_name",nname.name=nname.id,nname.type="text",nname.style="font-size: 2em",nname.required=!0,nname.value="",$("#notescontentframe").contents().find("#headerTitle").replaceWith(nname),$("#notescontentframe").contents().find("#note_name").replaceWith(nname),$("#notescontentframe").contents().find("tags").addClass("edit"),$("#notescontentframe").contents().find("#tbutton").remove();let tstate={tstate:!1,ttags:"",editor:"new",format:format};document.getElementById("notescontentframe").contentWindow.postMessage(tstate,location.href),$("#notescontentframe").contents().find("#note_name")[0].placeholder=rcmail.gettext("note_title","primitivenotes"),document.getElementById("editnote").classList.add("disabled"),document.getElementById("deletenote").classList.add("disabled"),document.getElementById("sendnote").classList.add("disabled")}function edit_note(){let nTitel=$("#notescontentframe").contents().find("#headerTitle");$("#notescontentframe").contents().find("#tbutton").remove();let nname=document.createElement("input");nname.id="note_name",nname.name=nname.id,nname.type="text",nname.style="font-size: 2em",nname.required=!0,nname.value=nTitel[0].innerText,nTitel.replaceWith(nname);let tstate={tstate:!1,editor:"edit"};document.getElementById("notescontentframe").contentWindow.postMessage(tstate,location.href),$("#notescontentframe").contents().find("tags").addClass("edit"),document.getElementById("editnote").classList.add("disabled")}function delete_note(){var a=window.frames.notescontentframe.document.getElementById("fname").value,b=window.frames.notescontentframe.document.getElementById("headerTitle").innerText,c=rcmail.gettext("note_del_note","primitivenotes").replace("%note%",b);if(a&&b){if(!confirm(c))return!1;$.ajax({url:"plugins/primitivenotes/notes.php",type:"post",data:{action:"delNote",mode:"delete",fileid:a},success:function(a){if(""!=a){var result=JSON.parse(a);""!=result.data&&confirm(result.message)&&$.ajax({url:"plugins/primitivenotes/notes.php",type:"post",data:{action:"delMedia",files:JSON.stringify(result.data)}})}document.getElementById("notescontentframe").src="plugins/primitivenotes/notes.php"}})}}function send_note(){var a=window.frames.notescontentframe.document.getElementById("fname").value,b=a.substring(a.lastIndexOf(".")+1);-1<"html pdf jpg png md txt".split(" ").indexOf(b)?rcmail.goto_url("mail/compose",{_note_type:b,_note_filename:a},!0):alert(rcmail.gettext("note_inv_format","primitivenotes"))}function sform(){fileName=this.value;for(var allowed_extensions=new Array("html","pdf","jpg","png","md","txt"),file_extension=fileName.split(".").pop().toLowerCase(),i=0;i<=allowed_extensions.length;i++)if(allowed_extensions[i]==file_extension)return document.getElementById("upl_form").submit(),!0;return alert('<roundcube:label name="primitivenotes.note_inv_format" />'),!1}window.rcmail&&rcmail.addEventListener("init",(function(a){if(rcmail.register_command("newnote",new_note,!0),rcmail.register_command("editnote",edit_note,!0),rcmail.register_command("deletenote",delete_note,!0),rcmail.register_command("sendnote",send_note,!0),rcmail.register_command("addnote",add_note,!0),rcmail.register_command("mdnote",new_note,!0),rcmail.register_command("txtnote",new_note,!0),rcmail.register_command("pnoptions",pnoptions,!0),document.getElementById("upl")&&document.getElementById("upl").addEventListener("change",sform,!1),"#pnotes"==window.location.hash&&rcmail.sections_list.select_row("primitivenotes"),rcmail.env.contextmenu){let pnotescmenu=rcmail.contextmenu.init({menu_name:"pnotescmenu",menu_source:"#nmenu"});$("#notescontentframe").on("load",(function(){$("#notescontentframe").contents().find("#filelist li").each((function(){$(this).on("contextmenu",(function(e){rcmail.contextmenu.show_one(e,this,this.firstChild.attributes.value,pnotescmenu)}))}))}))}}));