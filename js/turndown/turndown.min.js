var TurndownService=function(){"use strict";function extend(destination){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)source.hasOwnProperty(key)&&(destination[key]=source[key])}return destination}function repeat(character,count){return Array(count+1).join(character)}var blockElements=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function isBlock(node){return is(node,blockElements)}var voidElements=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function isVoid(node){return is(node,voidElements)}function hasVoid(node){return has(node,voidElements)}var meaningfulWhenBlankElements=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function isMeaningfulWhenBlank(node){return is(node,meaningfulWhenBlankElements)}function hasMeaningfulWhenBlank(node){return has(node,meaningfulWhenBlankElements)}function is(node,tagNames){return tagNames.indexOf(node.nodeName)>=0}function has(node,tagNames){return node.getElementsByTagName&&tagNames.some((function(tagName){return node.getElementsByTagName(tagName).length}))}var rules={};function cleanAttribute(attribute){return attribute?attribute.replace(/(\n+\s*)+/g,"\n"):""}function Rules(options){for(var key in this.options=options,this._keep=[],this._remove=[],this.blankRule={replacement:options.blankReplacement},this.keepReplacement=options.keepReplacement,this.defaultRule={replacement:options.defaultReplacement},this.array=[],options.rules)this.array.push(options.rules[key])}function findRule(rules,node,options){for(var i=0;i<rules.length;i++){var rule=rules[i];if(filterValue(rule,node,options))return rule}}function filterValue(rule,node,options){var filter=rule.filter;if("string"==typeof filter){if(filter===node.nodeName.toLowerCase())return!0}else if(Array.isArray(filter)){if(filter.indexOf(node.nodeName.toLowerCase())>-1)return!0}else{if("function"!=typeof filter)throw new TypeError("`filter` needs to be a string, array, or function");if(filter.call(rule,node,options))return!0}}function collapseWhitespace(options){var element=options.element,isBlock=options.isBlock,isVoid=options.isVoid,isPre=options.isPre||function(node){return"PRE"===node.nodeName};if(element.firstChild&&!isPre(element)){for(var prevText=null,prevVoid=!1,prev=null,node=next(prev,element,isPre);node!==element;){if(3===node.nodeType||4===node.nodeType){var text=node.data.replace(/[ \r\n\t]+/g," ");if(prevText&&!/ $/.test(prevText.data)||prevVoid||" "!==text[0]||(text=text.substr(1)),!text){node=remove(node);continue}node.data=text,prevText=node}else{if(1!==node.nodeType){node=remove(node);continue}isBlock(node)||"BR"===node.nodeName?(prevText&&(prevText.data=prevText.data.replace(/ $/,"")),prevText=null,prevVoid=!1):isVoid(node)&&(prevText=null,prevVoid=!0)}var nextNode=next(prev,node,isPre);prev=node,node=nextNode}prevText&&(prevText.data=prevText.data.replace(/ $/,""),prevText.data||remove(prevText))}}function remove(node){var next=node.nextSibling||node.parentNode;return node.parentNode.removeChild(node),next}function next(prev,current,isPre){return prev&&prev.parentNode===current||isPre(current)?current.nextSibling||current.parentNode:current.firstChild||current.nextSibling||current.parentNode}rules.paragraph={filter:"p",replacement:function(content){return"\n\n"+content+"\n\n"}},rules.lineBreak={filter:"br",replacement:function(content,node,options){return options.br+"\n"}},rules.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(content,node,options){var hLevel=Number(node.nodeName.charAt(1)),underline;return"setext"===options.headingStyle&&hLevel<3?"\n\n"+content+"\n"+repeat(1===hLevel?"=":"-",content.length)+"\n\n":"\n\n"+repeat("#",hLevel)+" "+content+"\n\n"}},rules.blockquote={filter:"blockquote",replacement:function(content){return"\n\n"+(content=(content=content.replace(/^\n+|\n+$/g,"")).replace(/^/gm,"> "))+"\n\n"}},rules.list={filter:["ul","ol"],replacement:function(content,node){var parent=node.parentNode;return"LI"===parent.nodeName&&parent.lastElementChild===node?"\n"+content:"\n\n"+content+"\n\n"}},rules.listItem={filter:"li",replacement:function(content,node,options){content=content.replace(/^\n+/,"").replace(/\n+$/,"\n").replace(/\n/gm,"\n    ");var prefix=options.bulletListMarker+"   ",parent=node.parentNode;if("OL"===parent.nodeName){var start=parent.getAttribute("start"),index=Array.prototype.indexOf.call(parent.children,node);prefix=(start?Number(start)+index:index+1)+".  "}return prefix+content+(node.nextSibling&&!/\n$/.test(content)?"\n":"")}},rules.indentedCodeBlock={filter:function(node,options){return"indented"===options.codeBlockStyle&&"PRE"===node.nodeName&&node.firstChild&&"CODE"===node.firstChild.nodeName},replacement:function(content,node,options){return"\n\n    "+node.firstChild.textContent.replace(/\n/g,"\n    ")+"\n\n"}},rules.fencedCodeBlock={filter:function(node,options){return"fenced"===options.codeBlockStyle&&"PRE"===node.nodeName&&node.firstChild&&"CODE"===node.firstChild.nodeName},replacement:function(content,node,options){for(var className,language=((node.firstChild.getAttribute("class")||"").match(/language-(\S+)/)||[null,""])[1],code=node.firstChild.textContent,fenceChar=options.fence.charAt(0),fenceSize=3,fenceInCodeRegex=new RegExp("^"+fenceChar+"{3,}","gm"),match;match=fenceInCodeRegex.exec(code);)match[0].length>=fenceSize&&(fenceSize=match[0].length+1);var fence=repeat(fenceChar,fenceSize);return"\n\n"+fence+language+"\n"+code.replace(/\n$/,"")+"\n"+fence+"\n\n"}},rules.horizontalRule={filter:"hr",replacement:function(content,node,options){return"\n\n"+options.hr+"\n\n"}},rules.inlineLink={filter:function(node,options){return"inlined"===options.linkStyle&&"A"===node.nodeName&&node.getAttribute("href")},replacement:function(content,node){var href=node.getAttribute("href"),title=cleanAttribute(node.getAttribute("title"));return title&&(title=' "'+title+'"'),"["+content+"]("+href+title+")"}},rules.referenceLink={filter:function(node,options){return"referenced"===options.linkStyle&&"A"===node.nodeName&&node.getAttribute("href")},replacement:function(content,node,options){var href=node.getAttribute("href"),title=cleanAttribute(node.getAttribute("title")),replacement,reference;switch(title&&(title=' "'+title+'"'),options.linkReferenceStyle){case"collapsed":replacement="["+content+"][]",reference="["+content+"]: "+href+title;break;case"shortcut":replacement="["+content+"]",reference="["+content+"]: "+href+title;break;default:var id=this.references.length+1;replacement="["+content+"]["+id+"]",reference="["+id+"]: "+href+title}return this.references.push(reference),replacement},references:[],append:function(options){var references="";return this.references.length&&(references="\n\n"+this.references.join("\n")+"\n\n",this.references=[]),references}},rules.emphasis={filter:["em","i"],replacement:function(content,node,options){return content.trim()?options.emDelimiter+content+options.emDelimiter:""}},rules.strong={filter:["strong","b"],replacement:function(content,node,options){return content.trim()?options.strongDelimiter+content+options.strongDelimiter:""}},rules.code={filter:function(node){var hasSiblings=node.previousSibling||node.nextSibling,isCodeBlock="PRE"===node.parentNode.nodeName&&!hasSiblings;return"CODE"===node.nodeName&&!isCodeBlock},replacement:function(content){if(!content.trim())return"";var delimiter="`",leadingSpace="",trailingSpace="",matches=content.match(/`+/gm);if(matches)for(/^`/.test(content)&&(leadingSpace=" "),/`$/.test(content)&&(trailingSpace=" ");-1!==matches.indexOf(delimiter);)delimiter+="`";return delimiter+leadingSpace+content+trailingSpace+delimiter}},rules.image={filter:"img",replacement:function(content,node){var alt=cleanAttribute(node.getAttribute("alt")),src=node.getAttribute("src")||"",title=cleanAttribute(node.getAttribute("title")),titlePart;return src?"!["+alt+"]("+src+(title?' "'+title+'"':"")+")":""}},Rules.prototype={add:function(key,rule){this.array.unshift(rule)},keep:function(filter){this._keep.unshift({filter:filter,replacement:this.keepReplacement})},remove:function(filter){this._remove.unshift({filter:filter,replacement:function(){return""}})},forNode:function(node){return node.isBlank?this.blankRule:(rule=findRule(this.array,node,this.options))?rule:(rule=findRule(this._keep,node,this.options))?rule:(rule=findRule(this._remove,node,this.options))?rule:this.defaultRule;var rule},forEach:function(fn){for(var i=0;i<this.array.length;i++)fn(this.array[i],i)}};var root="undefined"!=typeof window?window:{};function canParseHTMLNatively(){var Parser=root.DOMParser,canParse=!1;try{(new Parser).parseFromString("","text/html")&&(canParse=!0)}catch(e){}return canParse}function createHTMLParser(){var Parser=function(){};return shouldUseActiveX()?Parser.prototype.parseFromString=function(string){var doc=new window.ActiveXObject("htmlfile");return doc.designMode="on",doc.open(),doc.write(string),doc.close(),doc}:Parser.prototype.parseFromString=function(string){var doc=document.implementation.createHTMLDocument("");return doc.open(),doc.write(string),doc.close(),doc},Parser}function shouldUseActiveX(){var useActiveX=!1;try{document.implementation.createHTMLDocument("").open()}catch(e){window.ActiveXObject&&(useActiveX=!0)}return useActiveX}var HTMLParser=canParseHTMLNatively()?root.DOMParser:createHTMLParser(),_htmlParser;function RootNode(input){var root,doc;"string"==typeof input?root=htmlParser().parseFromString('<x-turndown id="turndown-root">'+input+"</x-turndown>","text/html").getElementById("turndown-root"):root=input.cloneNode(!0);return collapseWhitespace({element:root,isBlock:isBlock,isVoid:isVoid}),root}function htmlParser(){return _htmlParser=_htmlParser||new HTMLParser}function Node(node){return node.isBlock=isBlock(node),node.isCode="code"===node.nodeName.toLowerCase()||node.parentNode.isCode,node.isBlank=isBlank(node),node.flankingWhitespace=flankingWhitespace(node),node}function isBlank(node){return!isVoid(node)&&!isMeaningfulWhenBlank(node)&&/^\s*$/i.test(node.textContent)&&!hasVoid(node)&&!hasMeaningfulWhenBlank(node)}function flankingWhitespace(node){var leading="",trailing="";if(!node.isBlock){var hasLeading=/^\s/.test(node.textContent),hasTrailing=/\s$/.test(node.textContent),blankWithSpaces=node.isBlank&&hasLeading&&hasTrailing;hasLeading&&!isFlankedByWhitespace("left",node)&&(leading=" "),blankWithSpaces||!hasTrailing||isFlankedByWhitespace("right",node)||(trailing=" ")}return{leading:leading,trailing:trailing}}function isFlankedByWhitespace(side,node){var sibling,regExp,isFlanked;return"left"===side?(sibling=node.previousSibling,regExp=/ $/):(sibling=node.nextSibling,regExp=/^ /),sibling&&(3===sibling.nodeType?isFlanked=regExp.test(sibling.nodeValue):1!==sibling.nodeType||isBlock(sibling)||(isFlanked=regExp.test(sibling.textContent))),isFlanked}var reduce=Array.prototype.reduce,leadingNewLinesRegExp=/^\n*/,trailingNewLinesRegExp=/\n*$/,escapes=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function TurndownService(options){if(!(this instanceof TurndownService))return new TurndownService(options);var defaults={rules:rules,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",blankReplacement:function(content,node){return node.isBlock?"\n\n":""},keepReplacement:function(content,node){return node.isBlock?"\n\n"+node.outerHTML+"\n\n":node.outerHTML},defaultReplacement:function(content,node){return node.isBlock?"\n\n"+content+"\n\n":content}};this.options=extend({},defaults,options),this.rules=new Rules(this.options)}function process(parentNode){var self=this;return reduce.call(parentNode.childNodes,(function(output,node){var replacement="";return 3===(node=new Node(node)).nodeType?replacement=node.isCode?node.nodeValue:self.escape(node.nodeValue):1===node.nodeType&&(replacement=replacementForNode.call(self,node)),join(output,replacement)}),"")}function postProcess(output){var self=this;return this.rules.forEach((function(rule){"function"==typeof rule.append&&(output=join(output,rule.append(self.options)))})),output.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function replacementForNode(node){var rule=this.rules.forNode(node),content=process.call(this,node),whitespace=node.flankingWhitespace;return(whitespace.leading||whitespace.trailing)&&(content=content.trim()),whitespace.leading+rule.replacement(content,node,this.options)+whitespace.trailing}function separatingNewlines(output,replacement){var newlines=[output.match(trailingNewLinesRegExp)[0],replacement.match(leadingNewLinesRegExp)[0]].sort(),maxNewlines=newlines[newlines.length-1];return maxNewlines.length<2?maxNewlines:"\n\n"}function join(string1,string2){var separator=separatingNewlines(string1,string2);return(string1=string1.replace(trailingNewLinesRegExp,""))+separator+(string2=string2.replace(leadingNewLinesRegExp,""))}function canConvert(input){return null!=input&&("string"==typeof input||input.nodeType&&(1===input.nodeType||9===input.nodeType||11===input.nodeType))}return TurndownService.prototype={turndown:function(input){if(!canConvert(input))throw new TypeError(input+" is not a string, or an element/document/fragment node.");if(""===input)return"";var output=process.call(this,new RootNode(input));return postProcess.call(this,output)},use:function(plugin){if(Array.isArray(plugin))for(var i=0;i<plugin.length;i++)this.use(plugin[i]);else{if("function"!=typeof plugin)throw new TypeError("plugin must be a Function or an Array of Functions");plugin(this)}return this},addRule:function(key,rule){return this.rules.add(key,rule),this},keep:function(filter){return this.rules.keep(filter),this},remove:function(filter){return this.rules.remove(filter),this},escape:function(string){return escapes.reduce((function(accumulator,escape){return accumulator.replace(escape[0],escape[1])}),string)}},TurndownService}();